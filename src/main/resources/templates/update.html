<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymleaf.org">
<head>
    <title>ㅎㅇ</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" th:href="@{/assets/css/main.css}">
    <noscript><link rel="stylesheet" th:href="@{/assets/css/main.css}"></noscript>
</head>
<body class="is-preload">
<!-- Wrapper -->
<div id="wrapper">

    <!-- Header -->
    <header id="header">
        <div class="inner">
            <!-- Logo -->
            <a href="/" class="logo">
                <span class="symbol"><img src="images/logo.svg" alt="" /></span><span class="title">슈슈의 게시판</span>
            </a>

            <!-- Nav -->
            <nav>
                <ul>
                    <li><a href="#menu">Menu</a></li>
                </ul>
            </nav>

        </div>
    </header>

    <!-- Menu -->
    <nav id="menu">
        <h2>Menu</h2>
        <ul>
            <li><a href="/">메인</a></li>
            <li><a href="/join">회원가입</a></li>
            <li><a href="/login">로그인</a></li>
            <li><a href="/list">회원정보</a></li>
            <li><a href="/rent">책 대여</a></li>
        </ul>
    </nav>

    <div id="main">
        <div class="inner">
            <header>
                <h1>글 수정 페이지</h1>
            </header>
            <form th:action="@{|/update/${userInfo.userId}|}" method="post" name="updateForm">
                아이디: <input type="text" name="userId" th:value="${userInfo.userId}" readonly><br>
                비밀번호: <input type="password" name="userPw" th:value="${userInfo.userPw}"><br>
                이름: <input type="text" name="userName" th:value="${userInfo.userName}"><br>
                성별: <input type="text" name="userGender" th:value="${userInfo.userGender}"><br>
                생일: <input type="text" name="userBirth" th:value="${userInfo.userBirth}"><br>
                연락처: <input type="text" name="userPhone" th:value="${userInfo.userPhone}"><br>
                주소: <input type="text" name="userAddr" th:value="${userInfo.userAddr}"><br>
                이메일: <input type="text" name="userEmail" th:value="${userInfo.userEmail}"><br>

                <table id="bookList">
                    <thead>
                    <tr>
                        <th>책 이름</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="book, iterStat : ${userInfo.bookList}" name="bookList">
<!--                        <td th:text="${iterStat.index}"></td>-->
                        <td><input type="hidden" th:name="|bookList[${iterStat.index}]bookList.userId|" th:value="${book.userId}"></td>
                        <td><input type="hidden" th:name="|bookList[${iterStat.index}]bookList.seq|" th:value="${book.seq}"></td>
                        <td><input type="text" th:name="|bookList[${iterStat.index}]bookList.value|" th:value="${book.value}"></td>
                        <td>
                            <a th:href="@{|/deleteBook/${userInfo.userId}/${book.seq}|}">삭제</a>
<!--                            <button type="button" onclick="location.href='/deleteBook/[[${userInfo.userId}]]/[[${book.seq}]]'">-->
<!--                                삭제-->
<!--                            </button>-->
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div id="addPage" style="display:none;">
                    <label for="bookNum">책 번호 입력:</label>
                    <input type="text" id="bookNum" name="bookNum">
                    <button type="button" onclick="addBook()">확인</button>

                    <div id="hiddenBookNum"></div>
                    <div id="bookNameDisplay"></div>
                    <div id="hiddenAuthor"></div>
                    <div id="hiddenPublisher"></div>
                </div>

                <input type="submit" value="수정">
                <button type="button" onclick=history.back();>취소</button>

                <button type="button" onclick="addButton()">책 추가</button>

            </form>



<!--            -->
<!--            <div th:each="book : ${userInfo.bookList}">-->
<!--                <span th:text="${book.value}"></span>-->
<!--                <form th:action="@{/deleteBook}" method="post" >-->
<!--                    <input type="hidden" name="userId" th:value="${userInfo.userId}">-->
<!--                    <input type="hidden" name="bookNum" th:value="${book.bookNum}">-->
<!--                    <button type="submit">삭제</button>-->
<!--                </form>-->
<!--            </div>-->

    </div>

        <!-- Footer -->
        <footer id="footer">
            <div class="inner">
                <section>
                    <h2>Get in touch</h2>
                    <form method="post" action="#">
                        <div class="fields">
                            <div class="field half">
                                <input type="text" name="name" id="name" placeholder="Name" />
                            </div>
                            <div class="field half">
                                <input type="email" name="email" id="email" placeholder="Email" />
                            </div>
                            <div class="field">
                                <textarea name="message" id="message" placeholder="Message"></textarea>
                            </div>
                        </div>
                        <ul class="actions">
                            <li><input type="submit" value="Send" class="primary" /></li>
                        </ul>
                    </form>
                </section>
                <section>
                    <h2>Follow</h2>
                    <ul class="icons">
                        <li><a href="#" class="icon brands style2 fa-twitter"><span class="label">Twitter</span></a></li>
                        <li><a href="#" class="icon brands style2 fa-facebook-f"><span class="label">Facebook</span></a></li>
                        <li><a href="#" class="icon brands style2 fa-instagram"><span class="label">Instagram</span></a></li>
                        <li><a href="#" class="icon brands style2 fa-dribbble"><span class="label">Dribbble</span></a></li>
                        <li><a href="#" class="icon brands style2 fa-github"><span class="label">GitHub</span></a></li>
                        <li><a href="#" class="icon brands style2 fa-500px"><span class="label">500px</span></a></li>
                        <li><a href="#" class="icon solid style2 fa-phone"><span class="label">Phone</span></a></li>
                        <li><a href="#" class="icon solid style2 fa-envelope"><span class="label">Email</span></a></li>
                    </ul>
                </section>
                <ul class="copyright">
                    <li>&copy; Untitled. All rights reserved</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
                </ul>
            </div>
        </footer>

    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>

    <script th:inline="javascript">

        function addButton() {
        const addPage = document.getElementById('addPage');
            addPage.style.display = addPage.style.display === 'none' ? 'block' : 'none';
        }

        function addBook() {
            const bookNum = document.getElementById('bookNum').value.trim();

            if (!bookNum) {
                alert("책 번호를 입력하세요.");
                return;
            }

            fetch(`/addBook?bookNum=${bookNum}`)
                .then(response => response.json())
                .then(bookInfo => {
                    if (bookInfo === null || !bookInfo.bookName) {
                        alert("없는 책");
                    } else {
                        // alert("대출가능");

                        const tableBody = document.querySelector('#bookList tbody');
                        const newRow = document.createElement('tr');

                        newRow.innerHTML = `
                    <td><input type="hidden" name="bookList[${tableBody.children.length}].userId" value=""></td>
                    <td><input type="hidden" name="bookList[${tableBody.children.length}].bookNum" value="${bookInfo.bookNum}"></td>
                    <td><input type="text" name="bookList[${tableBody.children.length}].value" value="${bookInfo.bookName}"></td>
                    <td>
                        <a href="/deleteBook/userId/${bookInfo.bookNum}">삭제</a>
                    </td>
                `;
                        tableBody.appendChild(newRow);

                        document.getElementById('hiddenAuthor').value = bookInfo.author;
                        document.getElementById('hiddenPublisher').value = bookInfo.publisher;
                    }
                })
                .catch(error => {
                    alert("없는 책");
                });
        }


    </script>
</body>
</html>



